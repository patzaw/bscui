"use strict";function Scui(e){this.zoom_min=null,this.zoom_step=null,this.zoom_max=null,this.clip=null,this.id=e,this.svg=null,this.main_group=null,this.sel_group=null,this.ui_elements=null,this.selectable=new Set,this.buttons=new Set,this.select_event=null,this.operate_event=null,this.hover_event=null,this.selected=new Set,this.hovered=null,this.show_tooltips=!0,this.multiple_sel=!1,this.clientX=null,this.clientY=null,this.button={n:0,id:null,click:null},this.structure_shapes=new Set(["rect","circle","ellipse","line","polyline","polygon","path"]),this.ori_viewBox=null,this.png_scale=null,this.default_png_scale=null,this.zoom_current=null,this.stop_zoom=!1,this.moved=!1,this.touch_init_dist,this.touch_ori_point,this.init=function(e,t,Y,X,i=!0,n="30px",I=.5,V=20,F=1.1,R=!1,l=1,o="orange",r=.5,a=1,O={button:"yellow",selectable:"cyan"},c=.5,d=1,P=["rect","circle","ellipse","line","polyline","polygon","path"],D=250,W=100,s=!0){function u(e){"Control"==e.key&&(e=new Event("click"),E.dispatchEvent(e))}function m(e){"Control"==e.key&&(e=new Event("click"),x.dispatchEvent(e))}function h(e){"Escape"==e.key&&(e=new Event("click"),(_.show_tooltips?C:k).dispatchEvent(e))}var v,p,_=this,g=document.getElementById(_.id),y=create_html_element("div"),f=(y.setAttribute("style","width:100%; height:100%; position:relative;"),y.innerHTML=e,y.children[0]),b=(s&&(e=f.getElementsByTagName("*"),Array.from(e).forEach(e=>{sanitize_attr(e)})),f.removeAttribute("viewBox"),f.setAttribute("width","100%"),f.setAttribute("height","100%"),create_svg_element("g")),s=(Array.from(f.children).forEach(e=>{b.appendChild(e)}),f.appendChild(b),create_html_element("div")),e=(s.setAttribute("style","background-color: #3d3d3d2b;position: absolute;top: 0; left: 0;width: 20px; padding: 5px"),s.style.width=n,i&&y.appendChild(s),create_svg_icon("menu","Menu")),w=(s.appendChild(e),create_html_element("div")),n=(w.setAttribute("style","display: none;"),s.appendChild(w),create_html_element("div")),i=(n.style.height="20px",w.appendChild(n),create_svg_icon("select_all","Select all")),s=(w.appendChild(i),create_svg_icon("invert_sel","Invert selection")),x=(w.appendChild(s),create_svg_icon("single_sel","Single sel. mode (Ctrl.)")),E=(w.appendChild(x),x.style.display="none",create_svg_icon("multiple_sel","Multiple sel. mode (Ctrl)")),z=(w.appendChild(E),w.appendChild(n.cloneNode(!0)),create_svg_icon("fit","Reset view")),B=(w.appendChild(z),create_svg_icon("zoom_in","Zoom in")),A=(w.appendChild(B),create_svg_icon("zoom_out","Zoom out")),k=(w.appendChild(A),create_svg_icon("show_tooltips","Show tooltips (Esc.)")),C=(w.appendChild(k),k.style.display="none",create_svg_icon("hide_tooltips","Hide tooltips (Esc.)")),n=(w.appendChild(C),w.appendChild(n.cloneNode(!0)),create_svg_icon("code","Save SVG")),q=(w.appendChild(n),create_svg_icon("photo","Save PNG")),L=(w.appendChild(q),create_svg_icon("scale","Scale PNG")),N=(L.setAttribute("style","width: 50%; margin-right: 0; margin-left: auto; display: block;"),w.appendChild(L),create_html_element("div")),M=(N.style.display="none",N.style.width="100px",w.appendChild(N),create_html_element("input")),Z=(M.setAttribute("type","number"),M.setAttribute("min",0),M.setAttribute("step",1),M.value=l,M.setAttribute("style","text-align:right;"),M.style.width="50px",M.style.marginLeft="10px",M.style.display="inline",N.appendChild(M),create_svg_icon("close","Close")),e=(Z.style.height="20px",Z.style.display="inline",N.appendChild(Z),this.png_scale=M,e.addEventListener("click",function(e){var t=w.style.display;w.style.display="none"==t?"block":"none"}),i.addEventListener("click",function(e){_.update_selection(_.selectable)}),s.addEventListener("click",function(e){var t=array_setdiff(_.selectable,_.selected);_.update_selection(t)}),E.addEventListener("click",function(e){_.multiple_sel=!0,E.style.display="none",x.style.display="block"}),x.addEventListener("click",function(e){_.multiple_sel=!1,x.style.display="none",E.style.display="block"}),z.addEventListener("click",function(e){_.reset_view()}),B.addEventListener("click",function(e){_.zoom_in()}),A.addEventListener("click",function(e){_.zoom_out()}),C.addEventListener("click",function(e){_.show_tooltips=!1,C.style.display="none",k.style.display="block",T.style.visibility="hidden"}),k.addEventListener("click",function(e){_.show_tooltips=!0,k.style.display="none",C.style.display="block",f.dispatchEvent(_.hover_event)}),f.addEventListener("mouseover",function(e){document.addEventListener("keyup",h),document.addEventListener("keydown",u),document.addEventListener("keyup",m)}),f.addEventListener("mouseout",function(e){document.removeEventListener("keyup",h),document.removeEventListener("keydown",u),document.removeEventListener("keyup",m)}),q.addEventListener("click",function(e){_.save_png()}),n.addEventListener("click",function(e){_.save_svg()}),L.addEventListener("click",function(e){w.style.display;L.style.display="none",N.style.display="block",M.focus()}),Z.addEventListener("click",function(e){w.style.display;N.style.display="none",L.style.display="block"}),M.addEventListener("keyup",function(e){"Enter"==e.key&&(e=new Event("click"),Z.dispatchEvent(e))}),g.appendChild(y),create_svg_element("g"));if(f.appendChild(e),_.svg=f,_.main_group=b,_.sel_group=e,_.structure_shapes=new Set(P),_.ui_elements=t||{id:[],ui_type:[],title:[]},_.select_event=new CustomEvent("elementSelected",{detail:{id:_.id}}),_.operate_event=new CustomEvent("elementOperated",{detail:{id:_.id}}),_.hover_event=new CustomEvent("elementHovered",{detail:{id:_.id}}),_.zoom_current=1,_.zoom_min=I,_.zoom_max=V,_.zoom_step=F,_.clip=R,_.default_png_scale=l,t)for(let e=0;e<t.id.length;e++){var G=t.id[e];"selectable"==t.ui_type[e]&&_.selectable.add(G),"button"==t.ui_type[e]&&_.buttons.add(G)}Y.forEach(e=>{_.set_element_styles(e.element_styles,e.to_ignore,e.targeted_tags,e.append)}),X.forEach(e=>{_.set_element_attributes(e.element_attributes,e.to_ignore,e.targeted_tags,e.append)}),v=g.id,new Promise(function(i){!function e(){var t=document.getElementById(v).querySelector("svg");t?i(t):requestAnimationFrame(e)}()}).then(function(e){var t=e.getBoundingClientRect(),i=e.querySelector("g").getBoundingClientRect(),t=i.x-t.x+" "+(i.y-t.y)+" "+i.width+" "+i.height;e.setAttribute("viewBox",t),_.ori_viewBox=t}),f.addEventListener("wheel",function(e){_.wheel_zoom(e)}),f.addEventListener("touchstart",function(e){var t;2===e.touches.length&&(t=e.touches[0],e=e.touches[1],_.touch_init_dist=Math.hypot(e.clientX-t.clientX,e.clientY-t.clientY),_.touch_ori_point={x:(e.clientX+t.clientX)/2,y:(e.clientY+t.clientY)/2})}),f.addEventListener("touchmove",function(e){var t,i;2===e.touches.length&&(e.preventDefault(),t=e.touches[0],e=e.touches[1],i=Math.hypot(e.clientX-t.clientX,e.clientY-t.clientY),e.clientX,t.clientX,e.clientY,t.clientY,_.touch_zoom(i,_.touch_ori_point),_.touch_init_dist=i)}),f.addEventListener("mousedown",function(e){_.mouse_move(e)}),f.addEventListener("touchstart",function(e){1!=e.touches.length||_.clip&&1==_.zoom_current||_.touch_move(e)}),f.addEventListener("mousemove",function(e){var t=array_intersect(get_ancestors_ids(e.target),_.ui_elements.id)[0];clearTimeout(p),p=setTimeout(function(){_.hovered=t,_.clientX=e.clientX,_.clientY=e.clientY,f.dispatchEvent(_.hover_event)},W)}),f.addEventListener("pointerover",function(e){var t;"mouse"!==e.pointerType&&(t=array_intersect(get_ancestors_ids(e.target),_.ui_elements.id)[0],_.hovered=t,_.clientX=e.clientX-20,_.clientY=e.clientY-15,f.dispatchEvent(_.hover_event))});var S,H=f.parentElement,i=g.id+"..ui_tooltip",T=create_html_element("div");return T.id=i,T.style.visibility="hidden",H.appendChild(T),T.addEventListener("mouseover",function(e){clearTimeout(p),_.hovered=T.getAttribute("data-element"),document.addEventListener("keyup",h)}),T.addEventListener("mouseout",function(e){document.removeEventListener("keyup",h)}),f.addEventListener("elementHovered",function(e){var t,i,n,l,s=f.getElementById("hovered_shape");_.hovered?((!s||_.hovered!=s.getAttribute("data-element")&&(_.sel_group.removeChild(s),!0))&&(l="none",_.selectable.has(_.hovered)&&(l="selectable"),_.buttons.has(_.hovered)&&(l="button"),t=O[l])&&(n=aggregate_transformations(l=f.getElementById(_.hovered)),(i=l.cloneNode(!0)).setAttribute("data-element",_.hovered),i.setAttribute("transform",n),i.id="hovered_shape",i.style.visibility="visible",i.style.pointerEvents="none",_.structure_shapes.has(i.tagName)&&(i.style.fill="none",i.style.stroke=t,i.style.strokeWidth=i.style.strokeWidth+d,i.style.strokeOpacity=1,i.style.opacity=c),_.structure_shapes.forEach(e=>{e=i.getElementsByTagName(e);Array.from(e).forEach(e=>{e.id=null,e.style.fill="none",e.style.stroke=t,e.style.visibility="visible",e.style.strokeWidth=e.style.strokeWidth+d,e.style.strokeOpacity=1,e.style.opacity=c,e.style.pointerEvents="none"})}),_.sel_group.appendChild(i)),_.show_tooltips&&(l=!1,"visible"==T.style.visibility&&(T.getAttribute("data-element")!=_.hovered?T.style.visibility="hidden":l=!0),!l)&&(n=_.ui_elements.id.indexOf(_.hovered),l=_.ui_elements.title[n])&&(T.innerHTML=l,n=_.clientX-H.getBoundingClientRect().left+H.scrollLeft+20,l=_.clientY-H.getBoundingClientRect().top+H.scrollTop+15,T.style.left=n+"px",T.style.top=l+"px",T.style.display="block",T.style.position="absolute",T.setAttribute("data-element",_.hovered),T.style.visibility="visible")):(s&&_.sel_group.removeChild(s),T.style.visibility="hidden")}),f.addEventListener("click",function(e){if(!_.moved){var e=get_ancestors_ids(e.target),t=array_intersect(e,_.selectable)[0],i=array_intersect(e,_.buttons)[0];if(i)clearTimeout(S),S=setTimeout(function(){_.click_element(i,!1),f.dispatchEvent(_.operate_event)},D);else{var n,l,e=!0;if(t&&(e=!1,n=t,l=f.getElementById(t),(t=[t]).push(...get_all_descendant_ids(l)),t=array_intersect(t,_.selectable)),_.multiple_sel){if(!e)if(_.selected.has(n))for(var s of t)_.selected.delete(s);else for(var o of t)_.selected.add(o)}else if(e)_.selected.clear();else{_.selected.clear();for(var r of t)_.selected.add(r)}f.dispatchEvent(_.select_event)}}}),f.addEventListener("elementSelected",function(e){var t=_.sel_group.getElementsByTagName("*"),s=[],i=[],n=(_.selected.forEach(e=>{i.push("selection.-_-."+e)}),[]),t=(_.selectable.forEach(e=>{n.push("selection.-_-."+e)}),Array.from(t).forEach(e=>{n.includes(e.id)&&(s.push(e.id),i.includes(e.id)||e.parentElement.removeChild(e))}),_.selected.forEach(e=>{var t,i,n,l=f.getElementById(e);!s.includes("selection.-_-."+e)&&l&&(t=aggregate_transformations(l),(i=l.cloneNode(!0)).id="selection.-_-."+i.id,i.setAttribute("transform",t),i.style.visibility="visible",i.style.display="block",i.style.pointerEvents="none",_.structure_shapes.has(i.tagName)&&(i.style.fill="none",i.style.stroke=o,i.style.strokeWidth=i.style.strokeWidth+a,i.style.strokeOpacity=1,i.style.opacity=r),_.structure_shapes.forEach(e=>{e=i.getElementsByTagName(e);Array.from(e).forEach(e=>{e.style.fill="none",e.style.stroke=o,e.style.visibility="visible",e.style.display="block",e.style.strokeWidth=e.style.strokeWidth+a,e.style.strokeOpacity=1,e.style.opacity=r,e.style.pointerEvents="none"})}),n=array_intersect(get_all_descendant_ids(i),_.selectable),Array.from(i.getElementsByTagName("*")).forEach(e=>{n.includes(e.id)&&(e.id="selection.-_-."+e.id)}),s.push(e),s.push(...n),_.sel_group.appendChild(i))}),_.sel_group.getElementsByTagName("*"));Array.from(t).forEach(e=>{!n.includes(e.id)||i.includes(e.id)||e.parentElement.removeChild(e)})}),f.addEventListener("dblclick",function(e){_.moved||(clearTimeout(S),e=array_intersect(get_ancestors_ids(e.target),_.buttons)[0],_.click_element(e,!0),f.dispatchEvent(_.operate_event))}),g},this.update_selection=function(e){var t=this.svg;this.selected=new Set(array_intersect(e,this.selectable)),t.dispatchEvent(this.select_event)},this.click_element=function(e,t){var i=this,n=i.svg;i.buttons.has(e)&&"boolean"==typeof t&&(i.button.n=i.button.n+1,i.button.id=e,i.button.click=t?"double":"single",n.dispatchEvent(i.operate_event))},this.set_element_styles=function(n,l=[],s=this.structure_shapes,o=!1){var t=this.svg,r=(s=new Set(s),function(e,t){if(!l||!l.includes(e.id)){if(s.has(e.tagName))for(var i in n)"id"!=i&&(o&&e.style?e.style[i]=e.style[i]+" "+n[i][t]:e.style[i]=n[i][t]);Array.from(e.children).forEach(e=>{r(e,t)})}});if(n)for(let e=0;e<n.id.length;e++){var i=n.id[e],i=t.getElementById(i);i&&r(i,e)}},this.set_selection_styles=function(e,t=this.structure_shapes,i=!1){var n=this;if(0<n.selected.size){for(var l in e)for(;e[l].length<n.selected.size;)e[l].push(e[l][0]);e.id=[...n.selected];var s=array_setdiff(n.selectable,n.selected);n.set_element_styles(e,s,t,i)}},this.set_element_attributes=function(n,l=[],s=this.structure_shapes,o=!1){var t=this.svg,r=(s=new Set(s),function(e,t){if(!l||!l.includes(e.id)){if(s.has(e.tagName))for(var i in n)"id"!=i&&(o&&e.getAttribute(i)?e.setAttribute(i,e.getAttribute(i)+" "+n[i][t]):e.setAttribute(i,n[i][t]));Array.from(e.children).forEach(e=>{r(e,t)})}});if(n)for(let e=0;e<n.id.length;e++){var i=n.id[e],i=t.getElementById(i);i&&r(i,e)}},this.set_selection_attributes=function(e,t=this.structure_shapes,i=!1){var n=this;if(0<n.selected.size){for(var l in e)for(;e[l].length<n.selected.size;)e[l].push(e[l][0]);e.id=[...n.selected];var s=array_setdiff(n.selectable,n.selected);n.set_element_attributes(e,s,t,i)}},this.order_elements=function(e,n){var l=this.svg;e.forEach(e=>{var t,e=l.getElementById(e),i=e.parentNode;"front"==n&&i.appendChild(e),"back"==n&&(t=i.firstChild,i.insertBefore(e,t)),"forward"==n&&(t=(t=e.nextElementSibling)&&t.nextElementSibling)&&i.insertBefore(e,t),"backward"==n&&(t=e.previousElementSibling)&&i.insertBefore(e,t)})},this.add_element=function(e,t,i=null,n=null){var l=this,s=l.svg;l.ui_elements.id.includes(e)||(l.ui_elements.id.push(e),l.ui_elements.ui_type.push(i),l.ui_elements.title.push(n),"selectable"==i&&l.selectable.add(e),"button"==i&&l.buttons.add(e),(n=create_svg_element("g")).innerHTML=t,(i=n.firstChild).id=e,l.main_group.appendChild(i),t=s.getAttribute("viewBox"),s.removeAttribute("viewBox"),n=s.getBoundingClientRect(),i=(e=l.main_group.getBoundingClientRect()).x-n.x+" "+(e.y-n.y)+" "+e.width+" "+e.height,s.setAttribute("viewBox",t),l.ori_viewBox=i)},this.remove_elements=function(e){var n=this,l=n.svg;e.forEach(e=>{n.selectable.delete(e),n.selected.delete(e),n.buttons.delete(e);var t=n.ui_elements.id.indexOf(e),t=(-1!==t&&(n.ui_elements.id.splice(t,1),n.ui_elements.ui_type.splice(t,1),n.ui_elements.title.splice(t,1)),l.getElementById(e)),e=(t.parentElement.removeChild(t),l.getAttribute("viewBox")),t=(l.removeAttribute("viewBox"),l.getBoundingClientRect()),i=n.main_group.getBoundingClientRect(),t=i.x-t.x+" "+(i.y-t.y)+" "+i.width+" "+i.height;l.setAttribute("viewBox",e),n.ori_viewBox=t})},this.update_ui_elements=function(s){var o=this,r=o.svg;s.id.forEach(e=>{var t=s.id.indexOf(e),i=(s.ui_type&&"selectable"!=s.ui_type[t]&&(o.selected.delete(e),r.dispatchEvent(o.select_event)),o.selectable.delete(e),o.buttons.delete(e),o.ui_elements.id.indexOf(e)),n="none",l="";-1!==i&&(o.ui_elements.id.splice(i,1),n=o.ui_elements.ui_type.splice(i,1)[0],l=o.ui_elements.title.splice(i,1)[0]),o.ui_elements.id.push(e),s.ui_type?o.ui_elements.ui_type.push(s.ui_type[t]):o.ui_elements.ui_type.push(n),s.title?o.ui_elements.title.push(s.title[t]):o.ui_elements.title.push(l),"selectable"==s.ui_type[t]&&o.selectable.add(e),"button"==s.ui_type[t]&&o.buttons.add(e)})},this.reset_view=function(){this.svg.setAttribute("viewBox",this.ori_viewBox),this.zoom_current=1},this.zoom_in=function(){var e=this,t=e.svg,i=t.getAttribute("viewBox").split(" "),n=Number(i[0]),l=Number(i[1]),s=Number(i[2]),i=Number(i[3]),o=e.zoom_step,r=e.zoom_current*o;r>e.zoom_max||r<e.zoom_min||(e.clip&&Math.abs(Math.log10(r))<.001?(e.zoom_current=1,t.setAttribute("viewBox",e.ori_viewBox)):(e.zoom_current=r,t.setAttribute("viewBox",n+" "+l+" "+s/o+" "+i/o)))},this.zoom_out=function(){var e=this,t=e.svg,i=t.getAttribute("viewBox").split(" "),n=Number(i[0]),l=Number(i[1]),s=Number(i[2]),i=Number(i[3]),o=1/e.zoom_step,r=e.zoom_current*o;r>e.zoom_max||r<e.zoom_min||(e.clip&&Math.abs(Math.log10(r))<.001?(e.zoom_current=1,t.setAttribute("viewBox",e.ori_viewBox)):(e.zoom_current=r,t.setAttribute("viewBox",n+" "+l+" "+s/o+" "+i/o)))},this.wheel_zoom=function(e){var t,i,n,l,s,o,r,a,c,d=this;d.stop_zoom?d.stop_zoom=!1:(t=d.svg,n=point_to_area_ref(i={x:e.clientX,y:e.clientY},t),a=t.getAttribute("viewBox").split(" "),l=Number(a[0]),s=Number(a[1]),r=Number(a[2]),a=Number(a[3]),c=d.zoom_step,0<e.deltaY&&(c=1/c),(o=d.zoom_current*c)>d.zoom_max||o<d.zoom_min||(d.clip&&Math.abs(Math.log10(o))<.001?(d.zoom_current=1,d.stop_zoom=!0,t.setAttribute("viewBox",d.ori_viewBox)):(d.zoom_current=o,t.setAttribute("viewBox",l+" "+s+" "+(d=r/c)+" "+(o=a/c)),a=l-((r=point_to_area_ref(i,t)).x-n.x),c=s-(r.y-n.y),t.setAttribute("viewBox",a+" "+c+" "+d+" "+o),e.stopPropagation(),e.preventDefault())))},this.touch_zoom=function(e,t){var i,n,l,s,o,r,a,c=this;c.stop_zoom?c.stop_zoom=!1:(n=point_to_area_ref(t,i=c.svg),a=i.getAttribute("viewBox").split(" "),l=Number(a[0]),s=Number(a[1]),r=Number(a[2]),a=Number(a[3]),e/=c.touch_init_dist,(o=c.zoom_current*e)>c.zoom_max||o<c.zoom_min||(c.clip&&Math.abs(Math.log10(o))<.001?(c.zoom_current=1,c.stop_zoom=!0,i.setAttribute("viewBox",c.ori_viewBox)):(c.zoom_current=o,i.setAttribute("viewBox",l+" "+s+" "+(c=r/e)+" "+(o=a/e)),a=l-((r=point_to_area_ref(t,i)).x-n.x),e=s-(r.y-n.y),i.setAttribute("viewBox",a+" "+e+" "+c+" "+o))))},this.mouse_move=function(e){var a,t,i,c,d,n,u,m,h,v,p=this;function l(e){var r=e;h||(h=!0,setTimeout(function(){a.style.cursor="grabbing";var e=a.getAttribute("viewBox").split(" "),t=Number(e[0]),i=Number(e[1]),n=Number(e[2]),e=Number(e[3]),l={x:r.clientX,y:r.clientY},s=v.x-l.x,o=v.y-l.y;a.setAttribute("viewBox",t+m*s/c+" "+(i+u*o/d)+" "+n+" "+e),p.moved=!0,v=l,h=!1},40))}p.moved=!1,0!=e.button||p.clip&&1==p.zoom_current||(i=(a=p.svg).getAttribute("viewBox").split(" "),t=Number(i[2]),i=Number(i[3]),n=a.getBoundingClientRect(),c=n.width,d=n.height,n=c/d,Math.max(c,d),n<=t/i?u=(m=t)/n:m=(u=i)*n,h=!1,v={x:e.clientX,y:e.clientY},a.addEventListener("mousemove",l),a.addEventListener("mouseup",function e(t){a.removeEventListener("mousemove",l),a.removeEventListener("mouseup",e),a.style.cursor="auto",t.stopPropagation(),t.preventDefault()}),e.stopPropagation(),e.preventDefault())},this.touch_move=function(e){var t,a,i,n,c,d,l,u,m,h,v,p=this;function s(e){var r;e.stopPropagation(),e.preventDefault(),1!=e.touches.length||p.clip&&1==p.zoom_current||(r=e.touches[0],h)||(h=!0,setTimeout(function(){a.style.cursor="grabbing";var e=a.getAttribute("viewBox").split(" "),t=Number(e[0]),i=Number(e[1]),n=Number(e[2]),e=Number(e[3]),l={x:r.clientX,y:r.clientY},s=v.x-l.x,o=v.y-l.y;a.setAttribute("viewBox",t+m*s/c+" "+(i+u*o/d)+" "+n+" "+e),p.moved=!0,v=l,h=!1},40))}p.moved=!1,1!=e.touches.length||p.clip&&1==p.zoom_current||(t=e.touches[0],n=(a=p.svg).getAttribute("viewBox").split(" "),i=Number(n[2]),n=Number(n[3]),l=a.getBoundingClientRect(),c=l.width,d=l.height,l=c/d,Math.max(c,d),l<=i/n?u=(m=i)/l:m=(u=n)*l,h=!1,v={x:t.clientX,y:t.clientY},a.addEventListener("touchmove",s),a.addEventListener("touchend",function e(t){a.removeEventListener("touchmove",s),a.removeEventListener("touchend",e),a.style.cursor="auto",t.stopPropagation()}),e.stopPropagation())},this.get_core_svg=function(){for(var e=this.svg.cloneNode(!0),t=(e.setAttribute("viewBox",this.ori_viewBox),e.setAttribute("xmlns","http://www.w3.org/2000/svg"),e.removeChild(e.children[1]),e.children[0]);t.firstChild;)e.appendChild(t.firstChild);return e.removeChild(t),e},this.save_svg=function(){var e="data:image/svg+xml;base64,"+customBtoa('<?xml version="1.0" encoding="UTF-8" standalone="yes"?>'+this.get_core_svg().outerHTML),t=document.querySelector("body"),i=t.appendChild(create_html_element("a"));i.style.visibility="hidden",i.setAttribute("href",e),i.setAttribute("download","image.svg"),i.click(),t.removeChild(i)},this.save_png=function(){var e=this.svg.cloneNode(!0);e.setAttribute("version",1.1),e.setAttribute("xmlns","http://www.w3.org/2000/svg");var t=(t=Number(this.png_scale.value))||this.default_png_scale,i=this.ori_viewBox.split(" "),n=Number(i[0]),l=Number(i[1]),s=Number(i[2]),i=Number(i[3]);e.setAttribute("width",s),e.setAttribute("height",i),e.setAttribute("viewBox",n+" "+l+" "+s+" "+i);var n="data:image/svg+xml;base64,"+customBtoa(e.outerHTML),o=s*t,r=i*t,a=create_html_element("canvas"),c=(a.setAttribute("width",o),a.setAttribute("height",r),a.getContext("2d")),d=new Image;d.onload=function(){c.drawImage(d,0,0,o,r);var e=a.toDataURL("image/png"),t=document.querySelector("body"),i=t.appendChild(create_html_element("a"));i.style.visibility="hidden",i.setAttribute("download","image.png"),i.setAttribute("href",e),i.click(),t.removeChild(i)},d.src=n}}function create_svg_icon(e,i,t="#FFFFFF00",n="block"){for(var l=[{name:"menu",svg:`
         <path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 
         32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 
         0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 
         17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 
         32 14.3 32 32z"/></svg>
         `,viewBox:"0 0 448 512"},{name:"fit",svg:`
         <path d="m250 850l-187 0-63 0 0-62 0-188 63 0 0 188 187 0 0 62z 
         m688 0l-188 0 0-62 188 0 0-188 62 0 0 188 0 62-62 0z m-875-938l0 
         188-63 0 0-188 0-62 63 0 187 0 0 62-187 0z m875 188l0-188-188 0 
         0-62 188 0 62 0 0 62 0 188-62 0z m-125 188l-1 0-93-94-156 156 156 
         156 92-93 2 0 0 250-250 0 0-2 93-92-156-156-156 156 94 92 0 2-250 0 
         0-250 0 0 93 93 157-156-157-156-93 94 0 0 0-250 250 0 0 0-94 93 156 
         157 156-157-93-93 0 0 250 0 0 250z" 
         transform="matrix(1 0 0 -1 0 850)"></path>
         `,viewBox:"0 0 1000 1000"},{name:"zoom_in",svg:`
         <path d="m1 787l0-875 875 0 0 875-875 0z m687-500l-187 0 0-187-125 0 0 
         187-188 0 0 125 188 0 0 187 125 0 0-187 187 0 0-125z" 
         transform="matrix(1 0 0 -1 0 850)"></path>
         `,viewBox:"0 0 875 1000"},{name:"zoom_out",svg:`
         <path d="m0 788l0-876 875 0 0 876-875 0z m688-500l-500 0 0 125 500 0 
         0-125z" transform="matrix(1 0 0 -1 0 850)"></path>
         `,viewBox:"0 0 875 1000"},{name:"code",svg:`
         <path d="M392.8 1.2c-17-4.9-34.7 5-39.6 22l-128 448c-4.9 17 5 34.7 22 
         39.6s34.7-5 39.6-22l128-448c4.9-17-5-34.7-22-39.6zm80.6 120.1c-12.5 
         12.5-12.5 32.8 0 45.3L562.7 256l-89.4 89.4c-12.5 12.5-12.5 32.8 0 
         45.3s32.8 12.5 45.3 0l112-112c12.5-12.5 12.5-32.8 
         0-45.3l-112-112c-12.5-12.5-32.8-12.5-45.3 0zm-306.7 
         0c-12.5-12.5-32.8-12.5-45.3 0l-112 112c-12.5 12.5-12.5 32.8 0 
         45.3l112 112c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L77.3 
         256l89.4-89.4c12.5-12.5 12.5-32.8 0-45.3z"></path>
         `,viewBox:"0 0 640 512"},{name:"photo",svg:`
         <path d="m500 450c-83 0-150-67-150-150 0-83 67-150 150-150 83 0 150 67 
         150 150 0 83-67 150-150 150z m400 150h-120c-16 0-34 13-39 29l-31 93c-6 
         15-23 28-40 28h-340c-16 
         0-34-13-39-28l-31-94c-6-15-23-28-40-28h-120c-55 
         0-100-45-100-100v-450c0-55 45-100 100-100h800c55 0 100 45 100 
         100v450c0 55-45 100-100 100z m-400-550c-138 0-250 112-250 250 0 138 
         112 250 250 250 138 0 250-112 250-250 0-138-112-250-250-250z m365 
         380c-19 0-35 16-35 35 0 19 16 35 35 35 19 0 35-16 35-35 
         0-19-16-35-35-35z" transform="matrix(1 0 0 -1 0 850)"></path>`,viewBox:"0 0 1000 1000"},{name:"scale",svg:`
         <path d="M344 0H488c13.3 0 24 10.7 24 24V168c0 9.7-5.8 18.5-14.8 
         22.2s-19.3 1.7-26.2-5.2l-39-39-87 87c-9.4 9.4-24.6 9.4-33.9 
         0l-32-32c-9.4-9.4-9.4-24.6 0-33.9l87-87L327 
         41c-6.9-6.9-8.9-17.2-5.2-26.2S334.3 0 344 0zM168 512H24c-13.3 
         0-24-10.7-24-24V344c0-9.7 5.8-18.5 14.8-22.2s19.3-1.7 26.2 5.2l39 39 
         87-87c9.4-9.4 24.6-9.4 33.9 0l32 32c9.4 9.4 9.4 24.6 0 33.9l-87 87 39 
         39c6.9 6.9 8.9 17.2 5.2 26.2s-12.5 14.8-22.2 14.8z"></path>`,viewBox:"0 0 512 512"},{name:"close",svg:`
         <path d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM175 
         175c9.4-9.4 24.6-9.4 33.9 0l47 47 47-47c9.4-9.4 24.6-9.4 33.9 0s9.4 
         24.6 0 33.9l-47 47 47 47c9.4 9.4 9.4 24.6 0 33.9s-24.6 
         9.4-33.9 0l-47-47-47 47c-9.4 9.4-24.6 9.4-33.9 0s-9.4-24.6 
         0-33.9l47-47-47-47c-9.4-9.4-9.4-24.6 0-33.9z"></path>`,viewBox:"0 0 512 512"},{name:"select_all",svg:`
         <path d="M342.6 86.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L160
         178.7l-57.4-57.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l80
         80c12.5 12.5 32.8 12.5 45.3 0l160-160zm96 128c12.5-12.5 12.5-32.8
         0-45.3s-32.8-12.5-45.3 0L160 402.7 54.6 297.4c-12.5-12.5-32.8-12.5-45.3
         0s-12.5 32.8 0 45.3l128 128c12.5 12.5 32.8 12.5 45.3 0l256-256z">
         </path>`,viewBox:"0 0 448 512"},{name:"invert_sel",svg:`
         <path d="M 0 0 m 0 7.5 l 0 7.5 l 3 0 l 0 -7.5 Z m 0 7.5 m 0 7.5 l 0
         7.5 l 3 0 l 0 -7.5 Z m 0 7.5 m 0 7.5 l 0 7.5 l 3 0 l 0 -7.5
         Z m 0 7.5 m 0 7.5 l 0 7.5 l 3 0 l 0 -7.5 Z m 0 7.5 m 0 7.5
         l 0 7.5 l 3 0 l 0 -7.5 Z m 0 7.5 m 0 7.5 l 0 7.5 l 3 0 l 0
         -7.5 Z m 0 7.5 m 0 7.5 l 0 7.5 l 3 0 l 0 -7.5 Z m 0 7.5 m 0
         7.5 l 0 7.5 l 3 0 l 0 -7.5 Z m 0 7.5 m 0 7.5 l 0 7.5 l 3 0 l
         0 -7.5 Z m 0 7.5 m 0 7.5 l 0 7.5 l 3 0 l 0 -7.5 Z m 0 7.5 m
         0 7.5 l 0 7.5 l 3 0 l 0 -7.5 Z m 0 7.5 m 0 7.5 l 0 7.5 l 3 0
         l 0 -7.5 Z m 0 7.5 m 0 7.5 l 0 7.5 l 3 0 l 0 -7.5 Z m 0 7.5
         m 0 7.5 l 0 7.5 l 3 0 l 0 -7.5 Z m 0 7.5 m 0 7.5 l 0 7.5 l
         3 0 l 0 -7.5 Z m 0 7.5 m 0 7.5 l 0 7.5 l 3 0 l 0 -7.5 Z m 0
         7.5 m 0 7.5 l 0 7.5 l 3 0 l 0 -7.5 Z m 0 7.5 m 0 7.5 l 0 7.5
         l 3 0 l 0 -7.5 Z m 0 7.5 m 0 7.5 l 0 7.5 l 3 0 l 0 -7.5 Z m
         0 7.5 m 0 7.5 l 0 7.5 l 3 0 l 0 -7.5 Z m 3 7.5 m 7.5 0 l 7.5
         0 l 0 -3 l -7.5 0 Z m 7.5 0 m 7.5 0 l 7.5 0 l 0 -3 l -7.5
         0 Z m 7.5 0 m 7.5 0 l 7.5 0 l 0 -3 l -7.5 0 Z m 7.5 0 m 7.5
         0 l 7.5 0 l 0 -3 l -7.5 0 Z m 7.5 0 m 7.5 0 l 7.5 0 l 0 -3
         l -7.5 0 Z m 7.5 0 m 7.5 0 l 7.5 0 l 0 -3 l -7.5 0 Z m 7.5
         0 m 7.5 0 l 7.5 0 l 0 -3 l -7.5 0 Z m 7.5 0 m 7.5 0 l 7.5
         0 l 0 -3 l -7.5 0 Z m 7.5 0 m 7.5 0 l 7.5 0 l 0 -3 l -7.5
         0 Z m 7.5 0 m 7.5 0 l 7.5 0 l 0 -3 l -7.5 0 Z m 7.5 0 m 7.5
         0 l 7.5 0 l 0 -3 l -7.5 0 Z m 7.5 0 m 7.5 0 l 7.5 0 l 0 -3
         l -7.5 0 Z m 7.5 0 m 7.5 0 l 7.5 0 l 0 -3 l -7.5 0 Z m 7.5
         0 m 7.5 0 l 7.5 0 l 0 -3 l -7.5 0 Z m 7.5 0 m 7.5 0 l 7.5
         0 l 0 -3 l -7.5 0 Z m 7.5 0 m 7.5 0 l 7.5 0 l 0 -3 l -7.5 0
         Z m 7.5 0 m 7.5 0 l 7.5 0 l 0 -3 l -7.5 0 Z m 7.5 0 m 7.5 0
         l 7.5 0 l 0 -3 l -7.5 0 Z m 7.5 0 m 7.5 0 l 7.5 0 l 0 -3 l
         -7.5 0 Z m 7.5 0 M 0 0 L 300 0 L 300 300 L 220.71 220.71 A
         100 100 0 0 0 79.29 79.29 Z M 79.29 79.29 L 220.71 220.71 A
         100 100 0 0 1 79.29 79.29 Z">
         </path>
         `,viewBox:"0 0 300 300"},{name:"show_tooltips",svg:`
         <path d="M64 0C28.7 0 0 28.7 0 64V352c0 35.3 28.7 64 64 64h96v80c0
         6.1 3.4 11.6 8.8 14.3s11.9 2.1 16.8-1.5L309.3 416H448c35.3 0 64-28.7
         64-64V64c0-35.3-28.7-64-64-64H64z">
         </path>
         `,viewBox:"0 0 512 512"},{name:"hide_tooltips",svg:`
         <path d="M160 368c26.5 0 48 21.5 48 48v16l72.5-54.4c8.3-6.2 18.4-9.6
         28.8-9.6H448c8.8 0 16-7.2 16-16V64c0-8.8-7.2-16-16-16H64c-8.8 0-16
         7.2-16 16V352c0 8.8 7.2 16 16 16h96zm48 124l-.2 .2-5.1 3.8-17.1
         12.8c-4.8 3.6-11.3 4.2-16.8
         1.5s-8.8-8.2-8.8-14.3V474.7v-6.4V468v-4V416H112 64c-35.3
         0-64-28.7-64-64V64C0 28.7 28.7 0 64 0H448c35.3 0 64 28.7 64
         64V352c0 35.3-28.7 64-64 64H309.3L208 492z">
         </path>
         `,viewBox:"0 0 512 512"},{name:"single_sel",svg:`
         <path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5
         12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5
         45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z">
         </path>
         `,viewBox:"0 0 448 512"},{name:"multiple_sel",svg:`
         <path d="M224 32c0-17.7-14.3-32-32-32s-32 14.3-32 32V144H48c-17.7
         0-32 14.3-32 32s14.3 32 32 32H160V320c0 17.7 14.3 32 32 32s32-14.3
         32-32V208H336c17.7 0 32-14.3 32-32s-14.3-32-32-32H224V32zM0 480c0
         17.7 14.3 32 32 32H352c17.7 0 32-14.3 32-32s-14.3-32-32-32H32c-17.7
         0-32 14.3-32 32z">
         </path>
         `,viewBox:"0 0 384 512"}],s=0,s=0;s<l.length&&l[s].name!==e;s++);var o=create_svg_element("svg"),r=(o.innerHTML=`
   <g>
   <rect width="100%" height="100%" style="fill:${t};"></rect>
   ${l[s].svg}
   </g>
   `,o.setAttribute("viewBox",l[s].viewBox),o.setAttribute("display",n),o.style.cursor="pointer",Math.floor(1e9*Math.random()).toString);return o.addEventListener("pointerover",function(e){var t;document.getElementById(r)||((t=create_html_element("div")).id=r,t.textContent=i,t.style.left=e.pageX+10+"px",t.style.top=e.pageY+10+"px",t.style.position="absolute",t.style.background="#fff",t.style.border="1px solid #ccc",t.style.padding="5px",document.body.appendChild(t))}),o.addEventListener("pointerleave",function(e){var t=document.getElementById(r);t.parentElement.removeChild(t)}),o}function create_html_element(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function create_svg_element(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function point_to_area_ref(e,t){return new DOMPoint(e.x,e.y).matrixTransform(t.getScreenCTM().inverse())}function get_ancestors_ids(e){for(var t=[e.id],i=e.parentNode;null!==i;)t.push(i.id),i=i.parentNode;return t}function array_intersect(e,t){var e=new Set(e),i=new Set(t);return[...e].filter(e=>i.has(e))}function array_setdiff(e,t){var e=new Set(e),i=new Set(t);return[...e].filter(e=>!i.has(e))}function get_all_descendant_ids(e){var n=[];return function e(t){t.id&&n.push(t.id);for(var i=0;i<t.childNodes.length;i++)e(t.childNodes[i])}(e),n}function customBtoa(e){return e=e.replace(/[\u00A0-\u2666]/g,function(e){return"&#"+e.charCodeAt(0)+";"}),btoa(e)}function sanitize_attr(t){if(1===t.nodeType&&t.hasAttributes())for(let e=0;e<t.attributes.length;e++){var i=t.attributes[e];i.value=i.value.replace(/\s*<\s*/g," less than "),i.value=i.value.replace(/\s*>\s*/g," greater than ")}}function aggregate_transformations(e){let t="",i=e;for(;null!==i;){var n;"none"!=(n=parse_transform_matrix(i.getAttribute("transform")))&&(t=n+" "+t),i=i.parentElement}return t=(t=new DOMMatrix(t)).toString()}function parse_transform_matrix(e){if(!e||"none"==e)return"none";function t(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]}for(var i,n=[1,0,0,1,0,0],l=/(\w+)\(([^)]+)\)/g;null!==(i=l.exec(e));){var s=i[1],o=i[2].split(",");switch(s){case"matrix":n=t(n,o.map(parseFloat));break;case"translate":n=t(n,[1,0,0,1,parseFloat(o[0]),parseFloat(o[1]||0)]);break;case"scale":var r=parseFloat(o[0]);n=t(n,[r,0,0,parseFloat(o[1]||r),0,0]);break;case"rotate":var r=parseFloat(o[0])*Math.PI/180,a=Math.cos(r),c=Math.sin(r);n=t(n,[a,c,-c,a,0,0])}}return"matrix("+n.toString()+")"}