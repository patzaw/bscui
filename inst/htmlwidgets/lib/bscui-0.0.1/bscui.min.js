"use strict";function Sui(e){this.zoom_min=null,this.zoom_step=null,this.zoom_max=null,this.clip=null,this.id=e,this.svg=null,this.main_group=null,this.sel_group=null,this.ui_elements=null,this.selectable=[],this.buttons=[],this.select_event=null,this.operate_event=null,this.hover_event=null,this.selected=[],this.hovered=null,this.clientX=null,this.clientY=null,this.button={n:0,id:null},this.ori_viewBox=null,this.png_scale=null,this.default_png_scale=null,this.zoom_current=null,this.stop_zoom=!1,this.moved=!1,this.init=function(e,t,i=!0,n="20px",o=.5,l=20,s=1.1,r=!1,a=1,c="orange",d=250,u=500){var m,v,h=this,p=document.getElementById(h.id),_=create_html_element("div"),g=(_.setAttribute("style","width:100%; height:100%; position:relative;"),_.innerHTML=e,_.children[0]),e=(g.removeAttribute("viewBox"),g.setAttribute("width","100%"),g.setAttribute("height","100%"),create_html_element("div")),n=(e.setAttribute("style","background-color: #3d3d3d2b;position: absolute;top: 0; left: 0;width: 20px; padding: 5px"),e.style.width=n,i&&_.appendChild(e),create_svg_icon("menu","Menu")),y=(e.appendChild(n),create_html_element("div")),i=(y.setAttribute("style","display: none;"),e.appendChild(y),create_html_element("p")),e=(i.setAttribute("height","20px"),y.appendChild(i),create_svg_icon("fit","Reset view")),b=(y.appendChild(e),create_svg_icon("zoom_in","Zoom in")),f=(y.appendChild(b),create_svg_icon("zoom_out","Zoom out")),i=(y.appendChild(f),y.appendChild(i.cloneNode(!0)),create_svg_icon("code","Save SVG")),w=(y.appendChild(i),create_svg_icon("photo","Save PNG")),x=(y.appendChild(w),create_svg_icon("scale","Scale PNG")),z=(x.setAttribute("style","width: 50%; margin-right: 0; margin-left: auto; display: block;"),y.appendChild(x),create_html_element("div")),A=(z.style.display="none",z.style.width="100px",y.appendChild(z),create_html_element("input")),B=(A.setAttribute("type","number"),A.setAttribute("min",0),A.setAttribute("step",1),A.value=a,A.setAttribute("style","text-align:right;"),A.style.width="50px",A.style.marginLeft="10px",A.style.display="inline",z.appendChild(A),create_svg_icon("close","Close")),A=(B.style.height="20px",B.style.display="inline",z.appendChild(B),this.png_scale=A,n.addEventListener("click",function(e){var t=y.style.display;y.style.display="none"==t?"block":"none"}),e.addEventListener("click",function(e){h.reset_view()}),b.addEventListener("click",function(e){h.zoom_in()}),f.addEventListener("click",function(e){h.zoom_out()}),w.addEventListener("click",function(e){h.save_png()}),i.addEventListener("click",function(e){h.save_svg()}),x.addEventListener("click",function(e){y.style.display;x.style.display="none",z.style.display="block"}),B.addEventListener("click",function(e){y.style.display;z.style.display="none",x.style.display="block"}),p.appendChild(_),g.querySelector("g")),n=create_svg_element("g");if(g.appendChild(n),h.svg=g,h.main_group=A,h.sel_group=n,h.ui_elements=t,h.select_event=new CustomEvent("elementSelected",{detail:{id:h.id}}),h.operate_event=new CustomEvent("elementOperated",{detail:{id:h.id}}),h.hover_event=new CustomEvent("elementHovered",{detail:{id:h.id}}),h.zoom_current=1,h.zoom_min=o,h.zoom_max=l,h.zoom_step=s,h.clip=r,h.default_png_scale=a,t)for(let e=0;e<t.id.length;e++){var C,E=t.id[e],k=("selectable"==t.ui_type[e]&&h.selectable.push(E),"button"==t.ui_type[e]&&h.buttons.push(E),g.getElementById(E));for(C in t)"opacity"==C&&(k.style.opacity=t.opacity[e]),"fill"==C&&(k.style.fill=t.fill[e]),"fill_opacity"==C&&(k.style.fillOpacity=t.fill_opacity[e]),"stroke"==C&&(k.style.stroke=t.stroke[e]),"stroke_width"==C&&(k.style.strokeWidth=t.stroke_width[e]),"stroke_opacity"==C&&(k.style.strokeOpacity=t.stroke_opacity[e])}m=p.id,new Promise(function(i){!function e(){var t=document.getElementById(m).querySelector("svg");t?i(t):requestAnimationFrame(e)}()}).then(function(e){var t=e.querySelector("g").getBoundingClientRect(),t="0 0 "+t.width+" "+t.height;e.setAttribute("viewBox",t),h.ori_viewBox=t}),g.addEventListener("wheel",function(e){h.wheel_zoom(e)}),g.addEventListener("mousedown",function(e){h.mouse_move(e)}),g.addEventListener("mousemove",function(t){clearTimeout(v),v=setTimeout(function(){var e=array_intersect(get_ancestors_ids(t.target),h.ui_elements.id)[0];h.hovered=e,h.clientX=t.clientX,h.clientY=t.clientY,g.dispatchEvent(h.hover_event)},u)});var N,L=g.parentElement,e=p.id+"..ui_tooltip",M=create_html_element("div");return M.id=e,M.style.visibility="hidden",L.appendChild(M),M.addEventListener("mouseover",function(e){clearTimeout(v),h.hovered=M.getAttribute("data-element")}),g.addEventListener("elementHovered",function(e){var t,i;h.hovered?(t=!1,"visible"==M.style.visibility&&(M.getAttribute("data-element")!=h.hovered?M.style.visibility="hidden":t=!0),!t&&(t=h.ui_elements.id.indexOf(h.hovered),t=h.ui_elements.title[t])&&(M.innerHTML=t,t=h.clientX-L.getBoundingClientRect().left+L.scrollLeft+5,i=h.clientY-L.getBoundingClientRect().top+L.scrollTop+5,M.style.left=t+"px",M.style.top=i+"px",M.style.display="block",M.style.position="absolute",M.setAttribute("data-element",h.hovered),M.style.visibility="visible")):M.style.visibility="hidden"}),g.addEventListener("click",function(e){var t,i,n;h.moved?console.log("moving"):(t=array_intersect(n=get_ancestors_ids(e.target),h.selectable)[0],(i=array_intersect(n,h.buttons)[0])?(clearTimeout(N),N=setTimeout(function(){console.log(i),console.log("single click")},d)):(e.ctrlKey?t&&(-1==(n=h.selected.indexOf(t))?h.selected.push(t):h.selected.splice(n,1)):h.selected=t?[t]:[],g.dispatchEvent(h.select_event)))}),g.addEventListener("elementSelected",function(e){var t=h.sel_group.children,i=[];Array.from(t).forEach(e=>{i.push(e.id),h.selected.includes(e.id)||h.sel_group.removeChild(e)}),h.selected.forEach(e=>{i.includes(e)||((e=g.getElementById(e).cloneNode(!0)).id="selection.-_-."+e.id,e.style.fill="none",e.style.stroke=c,e.style.visibility="visible",e.style.strokeWidth=e.style.strokeWidth+2,e.style.strokeOpacity=1,e.style.opacity=.5,e.style.pointerEvents="none",h.sel_group.appendChild(e))})}),g.addEventListener("dblclick",function(e){h.moved?console.log("moving"):(clearTimeout(N),e=array_intersect(get_ancestors_ids(e.target),h.buttons)[0],console.log(e),console.log("double click"))}),p},this.reset_view=function(){this.svg.setAttribute("viewBox",this.ori_viewBox),this.zoom_current=1},this.zoom_in=function(){var e=this,t=e.svg,i=t.getAttribute("viewBox").split(" "),n=Number(i[0]),o=Number(i[1]),l=Number(i[2]),i=Number(i[3]),s=e.zoom_step,r=e.zoom_current*s;r>e.zoom_max||r<e.zoom_min||(e.clip&&Math.abs(Math.log10(r))<.001?(e.zoom_current=1,t.setAttribute("viewBox",e.ori_viewBox)):(e.zoom_current=r,t.setAttribute("viewBox",n+" "+o+" "+l/s+" "+i/s)))},this.zoom_out=function(){var e=this,t=e.svg,i=t.getAttribute("viewBox").split(" "),n=Number(i[0]),o=Number(i[1]),l=Number(i[2]),i=Number(i[3]),s=1/e.zoom_step,r=e.zoom_current*s;r>e.zoom_max||r<e.zoom_min||(e.clip&&Math.abs(Math.log10(r))<.001?(e.zoom_current=1,t.setAttribute("viewBox",e.ori_viewBox)):(e.zoom_current=r,t.setAttribute("viewBox",n+" "+o+" "+l/s+" "+i/s)))},this.wheel_zoom=function(e){var t,i,n,o,l,s,r,a,c,d=this;d.stop_zoom?d.stop_zoom=!1:(t=d.svg,n=point_to_area_ref(i={x:e.clientX,y:e.clientY},t),a=t.getAttribute("viewBox").split(" "),o=Number(a[0]),l=Number(a[1]),r=Number(a[2]),a=Number(a[3]),t.getBoundingClientRect().width,c=d.zoom_step,0<e.deltaY&&(c=1/c),(s=d.zoom_current*c)>d.zoom_max||s<d.zoom_min||(d.clip&&Math.abs(Math.log10(s))<.001?(d.zoom_current=1,d.stop_zoom=!0,t.setAttribute("viewBox",d.ori_viewBox)):(d.zoom_current=s,t.setAttribute("viewBox",o+" "+l+" "+(d=r/c)+" "+(s=a/c)),a=o-((r=point_to_area_ref(i,t)).x-n.x),c=l-(r.y-n.y),t.setAttribute("viewBox",a+" "+c+" "+d+" "+s),e.stopPropagation(),e.preventDefault())))},this.mouse_move=function(e){var a,t,i,c,d,n,u,m,v,h,p=this;function o(e){var r=e;v||(v=!0,setTimeout(function(){var e=a.getAttribute("viewBox").split(" "),t=Number(e[0]),i=Number(e[1]),n=Number(e[2]),e=Number(e[3]),o={x:r.clientX,y:r.clientY},l=h.x-o.x,s=h.y-o.y;a.setAttribute("viewBox",t+m*l/c+" "+(i+u*s/d)+" "+n+" "+e),p.moved=!0,h=o,v=!1},40))}p.moved=!1,0!=e.button||p.clip&&1==p.zoom_current||(i=(a=p.svg).getAttribute("viewBox").split(" "),t=Number(i[2]),i=Number(i[3]),n=a.getBoundingClientRect(),c=n.width,d=n.height,n=c/d,Math.max(c,d),n<=t/i?u=(m=t)/n:m=(u=i)*n,v=!1,h={x:e.clientX,y:e.clientY},a.addEventListener("mousemove",o),a.addEventListener("mouseup",function(e){a.removeEventListener("mousemove",o),e.stopPropagation(),e.preventDefault()}),e.stopPropagation(),e.preventDefault())},this.save_svg=function(){var e=this.svg.cloneNode(!0),e=(e.setAttribute("viewBox",this.ori_viewBox),e.outerHTML),e="data:image/svg+xml;base64,"+btoa('<?xml version="1.0" encoding="UTF-8" standalone="yes"?>'+e),t=document.querySelector("body"),i=t.appendChild(create_html_element("a"));i.style.visibility="hidden",i.setAttribute("href",e),i.setAttribute("download","image.svg"),i.click(),t.removeChild(i)},this.save_png=function(){var e=this.svg.cloneNode(!0);e.setAttribute("version",1.1),e.setAttribute("xmlns","http://www.w3.org/2000/svg");var t=(t=Number(this.png_scale.value))||this.default_png_scale,i=this.ori_viewBox.split(" "),n=Number(i[0]),o=Number(i[1]),l=Number(i[2]),i=Number(i[3]),n=(e.setAttribute("width",l),e.setAttribute("height",i),e.setAttribute("viewBox",n+" "+o+" "+l+" "+i),e.outerHTML),n="data:image/svg+xml;base64,"+btoa(n),s=l*t,r=i*t,a=create_html_element("canvas"),c=(a.setAttribute("width",s),a.setAttribute("height",r),a.getContext("2d")),d=new Image;d.onload=function(){c.drawImage(d,0,0,s,r);var e=a.toDataURL("image/png"),t=document.querySelector("body"),i=t.appendChild(create_html_element("a"));i.style.visibility="hidden",i.setAttribute("download","image.png"),i.setAttribute("href",e),i.click(),t.removeChild(i)},d.src=n}}function create_svg_icon(e,t,i="#FFFFFF00"){for(var n=[{name:"menu",svg:`
         <path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 
         32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 
         0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 
         17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 
         32 14.3 32 32z"/></svg>
         `,viewBox:"0 0 448 512"},{name:"fit",svg:`
         <path d="m250 850l-187 0-63 0 0-62 0-188 63 0 0 188 187 0 0 62z 
         m688 0l-188 0 0-62 188 0 0-188 62 0 0 188 0 62-62 0z m-875-938l0 
         188-63 0 0-188 0-62 63 0 187 0 0 62-187 0z m875 188l0-188-188 0 
         0-62 188 0 62 0 0 62 0 188-62 0z m-125 188l-1 0-93-94-156 156 156 
         156 92-93 2 0 0 250-250 0 0-2 93-92-156-156-156 156 94 92 0 2-250 0 
         0-250 0 0 93 93 157-156-157-156-93 94 0 0 0-250 250 0 0 0-94 93 156 
         157 156-157-93-93 0 0 250 0 0 250z" 
         transform="matrix(1 0 0 -1 0 850)"></path>
         `,viewBox:"0 0 1000 1000"},{name:"zoom_in",svg:`
         <path d="m1 787l0-875 875 0 0 875-875 0z m687-500l-187 0 0-187-125 0 0 
         187-188 0 0 125 188 0 0 187 125 0 0-187 187 0 0-125z" 
         transform="matrix(1 0 0 -1 0 850)"></path>
         `,viewBox:"0 0 875 1000"},{name:"zoom_out",svg:`
         <path d="m0 788l0-876 875 0 0 876-875 0z m688-500l-500 0 0 125 500 0 
         0-125z" transform="matrix(1 0 0 -1 0 850)"></path>
         `,viewBox:"0 0 875 1000"},{name:"code",svg:`
         <path d="M392.8 1.2c-17-4.9-34.7 5-39.6 22l-128 448c-4.9 17 5 34.7 22 
         39.6s34.7-5 39.6-22l128-448c4.9-17-5-34.7-22-39.6zm80.6 120.1c-12.5 
         12.5-12.5 32.8 0 45.3L562.7 256l-89.4 89.4c-12.5 12.5-12.5 32.8 0 
         45.3s32.8 12.5 45.3 0l112-112c12.5-12.5 12.5-32.8 
         0-45.3l-112-112c-12.5-12.5-32.8-12.5-45.3 0zm-306.7 
         0c-12.5-12.5-32.8-12.5-45.3 0l-112 112c-12.5 12.5-12.5 32.8 0 
         45.3l112 112c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L77.3 
         256l89.4-89.4c12.5-12.5 12.5-32.8 0-45.3z"></path>
         `,viewBox:"0 0 640 512"},{name:"photo",svg:`
         <path d="m500 450c-83 0-150-67-150-150 0-83 67-150 150-150 83 0 150 67 
         150 150 0 83-67 150-150 150z m400 150h-120c-16 0-34 13-39 29l-31 93c-6 
         15-23 28-40 28h-340c-16 
         0-34-13-39-28l-31-94c-6-15-23-28-40-28h-120c-55 
         0-100-45-100-100v-450c0-55 45-100 100-100h800c55 0 100 45 100 
         100v450c0 55-45 100-100 100z m-400-550c-138 0-250 112-250 250 0 138 
         112 250 250 250 138 0 250-112 250-250 0-138-112-250-250-250z m365 
         380c-19 0-35 16-35 35 0 19 16 35 35 35 19 0 35-16 35-35 
         0-19-16-35-35-35z" transform="matrix(1 0 0 -1 0 850)"></path>`,viewBox:"0 0 1000 1000"},{name:"scale",svg:`
         <path d="M344 0H488c13.3 0 24 10.7 24 24V168c0 9.7-5.8 18.5-14.8 
         22.2s-19.3 1.7-26.2-5.2l-39-39-87 87c-9.4 9.4-24.6 9.4-33.9 
         0l-32-32c-9.4-9.4-9.4-24.6 0-33.9l87-87L327 
         41c-6.9-6.9-8.9-17.2-5.2-26.2S334.3 0 344 0zM168 512H24c-13.3 
         0-24-10.7-24-24V344c0-9.7 5.8-18.5 14.8-22.2s19.3-1.7 26.2 5.2l39 39 
         87-87c9.4-9.4 24.6-9.4 33.9 0l32 32c9.4 9.4 9.4 24.6 0 33.9l-87 87 39 
         39c6.9 6.9 8.9 17.2 5.2 26.2s-12.5 14.8-22.2 14.8z"></path>`,viewBox:"0 0 512 512"},{name:"close",svg:`
         <path d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM175 
         175c9.4-9.4 24.6-9.4 33.9 0l47 47 47-47c9.4-9.4 24.6-9.4 33.9 0s9.4 
         24.6 0 33.9l-47 47 47 47c9.4 9.4 9.4 24.6 0 33.9s-24.6 
         9.4-33.9 0l-47-47-47 47c-9.4 9.4-24.6 9.4-33.9 0s-9.4-24.6 
         0-33.9l47-47-47-47c-9.4-9.4-9.4-24.6 0-33.9z"></path>`,viewBox:"0 0 512 512"}],o=0,o=0;o<n.length&&n[o].name!==e;o++);var l=create_svg_element("svg");return l.innerHTML=`
   <g><title>${t}</title>
   <rect width="100%" height="100%" style="fill:${i};"></rect>
   ${n[o].svg}
   </g>
   `,l.setAttribute("viewBox",n[o].viewBox),l}function create_html_element(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function create_svg_element(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function point_to_area_ref(e,t){return new DOMPoint(e.x,e.y).matrixTransform(t.getScreenCTM().inverse())}function get_ancestors_ids(e){for(var t=[e.id],i=e.parentNode;null!==i;)t.push(i.id),i=i.parentNode;return t}function array_intersect(e,t){const i=new Set(t);return e.filter(e=>i.has(e))}